
<!DOCTYPE html>
<html lang="es">
<head>
  <!-- (El head se mantiene igual que en el código anterior) -->
</head>
<body>
  <!-- (El header y las secciones iniciales se mantienen igual) -->

  <!-- Panel de Dashboard - Sección agregada para perfil de usuario -->
  <section id="panel" class="panel">
    <div class="cabecera-panel">
      <h2 class="titulo-panel">
        <i class="fas fa-tachometer-alt"></i> Panel de Control
      </h2>
      <div class="menu-usuario">
        <button class="btn-perfil" onclick="mostrarPerfil()">
          <i class="fas fa-user-circle"></i> <span id="nombreUsuario"></span>
        </button>
        <button class="btn-cerrar-sesion" onclick="cerrarSesion()">
          <i class="fas fa-sign-out-alt"></i> Cerrar sesión
        </button>
      </div>
    </div>

    <!-- Sección de Perfil (nueva) -->
    <div id="seccionPerfil" class="seccion-perfil" style="display: none;">
      <h3><i class="fas fa-user-cog"></i> Mi Perfil</h3>
      <form id="formularioPerfil">
        <div class="fila-formulario">
          <div class="grupo-formulario">
            <label for="perfilNombre">Nombre completo</label>
            <input type="text" id="perfilNombre" required>
          </div>
          <div class="grupo-formulario">
            <label for="perfilEmail">Correo electrónico</label>
            <input type="email" id="perfilEmail" required>
          </div>
        </div>
        <div class="fila-formulario">
          <div class="grupo-formulario">
            <label for="perfilDireccion">Dirección</label>
            <input type="text" id="perfilDireccion">
          </div>
          <div class="grupo-formulario">
            <label for="perfilCiudad">Ciudad</label>
            <input type="text" id="perfilCiudad">
          </div>
        </div>
        <div class="fila-formulario">
          <div class="grupo-formulario">
            <label for="perfilPais">País</label>
            <select id="perfilPais">
              <option value="">Selecciona tu país</option>
              <option>Colombia</option>
              <option>México</option>
              <option>Argentina</option>
              <option>Otro</option>
            </select>
          </div>
        </div>
        <button type="submit" class="btn btn-primario">
          <i class="fas fa-save"></i> Guardar Cambios
        </button>
      </form>
    </div>

    <!-- (El resto del panel se mantiene igual) -->
  </section>

  <!-- (El footer se mantiene igual) -->

  <script>
    // Variables globales
    let usuarioActual = null;
    const conexionesDispositivos = {};

    // Al cargar la página, verificar si hay sesión guardada
    document.addEventListener('DOMContentLoaded', function() {
      const usuarioGuardado = localStorage.getItem('usuarioIoT');
      if(usuarioGuardado) {
        const usuario = JSON.parse(usuarioGuardado);
        iniciarSesion(usuario);
      }
    });

    // Función para iniciar sesión (modificada)
    function iniciarSesion(usuario) {
      usuarioActual = usuario;
      localStorage.setItem('usuarioIoT', JSON.stringify(usuario));
      mostrarPanel(usuario.usuario);
      cargarPerfil(usuario);
      
      // Simular conexión de dispositivos después de 3 segundos
      setTimeout(simularConexionDispositivos, 3000);
    }

    // Función para cargar datos del perfil
    function cargarPerfil(usuario) {
      document.getElementById('perfilNombre').value = usuario.nombre || '';
      document.getElementById('perfilEmail').value = usuario.correo || '';
      document.getElementById('perfilDireccion').value = usuario.direccion || '';
      document.getElementById('perfilCiudad').value = usuario.ciudad || '';
      document.getElementById('perfilPais').value = usuario.pais || '';
    }

    // Función para mostrar/ocultar perfil
    function mostrarPerfil() {
      const seccion = document.getElementById('seccionPerfil');
      seccion.style.display = seccion.style.display === 'none' ? 'block' : 'none';
    }

    // Función para guardar cambios de perfil
    document.getElementById('formularioPerfil').addEventListener('submit', function(e) {
      e.preventDefault();
      
      usuarioActual.nombre = document.getElementById('perfilNombre').value;
      usuarioActual.correo = document.getElementById('perfilEmail').value;
      usuarioActual.direccion = document.getElementById('perfilDireccion').value;
      usuarioActual.ciudad = document.getElementById('perfilCiudad').value;
      usuarioActual.pais = document.getElementById('perfilPais').value;
      
      localStorage.setItem('usuarioIoT', JSON.stringify(usuarioActual));
      alert('Perfil actualizado correctamente');
    });

    // Función para simular conexión/desconexión de dispositivos
    function simularConexionDispositivos() {
      if(!usuarioActual || !dispositivos[usuarioActual.usuario]) return;
      
      dispositivos[usuarioActual.usuario].forEach(dispositivo => {
        if(!conexionesDispositivos[dispositivo.nombre]) {
          // Estado inicial aleatorio
          conexionesDispositivos[dispositivo.nombre] = {
            conectado: Math.random() > 0.5,
            intervalo: null
          };
          
          // Configurar intervalo para cambios de estado
          conexionesDispositivos[dispositivo.nombre].intervalo = setInterval(() => {
            const nuevoEstado = !conexionesDispositivos[dispositivo.nombre].conectado;
            conexionesDispositivos[dispositivo.nombre].conectado = nuevoEstado;
            
            // Mostrar notificación
            mostrarNotificacion(
              nuevoEstado ? 'Conexión establecida' : 'Desconexión detectada',
              `El dispositivo ${dispositivo.nombre} se ha ${nuevoEstado ? 'conectado' : 'desconectado'}`,
              nuevoEstado ? 'success' : 'error'
            );
            
            // Actualizar estado en la interfaz
            actualizarEstadoDispositivo(dispositivo.nombre, nuevoEstado);
          }, Math.random() * 10000 + 5000); // Entre 5 y 15 segundos
        }
      });
    }

    // Función para mostrar notificaciones
    function mostrarNotificacion(titulo, mensaje, tipo) {
      const notificacion = document.createElement('div');
      notificacion.className = `notificacion ${tipo}`;
      notificacion.innerHTML = `
        <strong>${titulo}</strong>
        <p>${mensaje}</p>
      `;
      
      document.body.appendChild(notificacion);
      
      setTimeout(() => {
        notificacion.classList.add('mostrar');
      }, 100);
      
      setTimeout(() => {
        notificacion.classList.remove('mostrar');
        setTimeout(() => {
          document.body.removeChild(notificacion);
        }, 300);
      }, 5000);
    }

    // Función para actualizar estado de dispositivo en la interfaz
    function actualizarEstadoDispositivo(nombreDispositivo, conectado) {
      const elementos = document.querySelectorAll('.nombre-dispositivo');
      elementos.forEach(elemento => {
        if(elemento.textContent === nombreDispositivo) {
          const estado = elemento.parentElement.querySelector('.estado-dispositivo');
          estado.className = `estado-dispositivo ${conectado ? 'online' : 'desconectado'}`;
          estado.textContent = conectado ? 'En línea' : 'Desconectado';
        }
      });
    }

    // Función para cerrar sesión (modificada)
    function cerrarSesion() {
      // Detener todos los intervalos de dispositivos
      Object.values(conexionesDispositivos).forEach(conexion => {
        if(conexion.intervalo) clearInterval(conexion.intervalo);
      });
      
      localStorage.removeItem('usuarioIoT');
      usuarioActual = null;
      mostrarBienvenida();
    }

    /* (El resto de las funciones se mantienen igual) */
  </script>

  <style>
    /* Estilos adicionales */
    .menu-usuario {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    
    .btn-perfil {
      background: none;
      border: none;
      color: var(--color-primario);
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .seccion-perfil {
      background: var(--color-claro);
      padding: 20px;
      border-radius: var(--borde-redondeado);
      margin-bottom: 30px;
    }
    
    .notificacion {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 300px;
      padding: 15px;
      border-radius: var(--borde-redondeado);
      box-shadow: var(--sombra);
      background: white;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
    }
    
    .notificacion.mostrar {
      transform: translateX(0);
    }
    
    .notificacion.success {
      border-left: 4px solid var(--color-exito);
    }
    
    .notificacion.error {
      border-left: 4px solid var(--color-destacado);
    }
  </style>
</body>
</html>
